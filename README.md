# nextbtcpool
Self-host your own transparent nextBTC mining pool. PPLNS, fixed 1% operator fee, 0% dev fee.
# nbpool - Self-Hosted nextBTC Mining Pool Deployment Guide

## 🚀 Introduction

**nbpool** is a lightweight, high-performance, self-hosted mining pool designed specifically for the nextBTC network. It utilizes the **PPLNS (Pay Per Last N Shares)** reward distribution model and aims to provide community members with a stable, transparent, and easy-to-deploy mining solution.

## ✨ Core Features

*   **PPLNS Reward System**: Fairly rewards long-term, loyal miners.
*   **No Registration Required**: Miners can start mining immediately using their nextBTC wallet address as their username.
*   **Automated Payouts**: The system automatically processes batch payments to miners who have reached the minimum payout threshold, requiring no manual intervention.
*   **Lightweight & Efficient**: Low resource consumption, making it suitable for a wide range of server hardware.
*   **API Support**: Provides a simple API server for users to check pool statistics and their personal hashrate.
*   **<ins>Transparent Fee Model</ins>**: **<ins>A fixed 1% pool fee with zero developer share, ensuring transparency for both operators and miners.</ins>**

## 💰 Fee Structure & Revenue Transparency

**To build complete trust and transparency, nbpool operates on a clear and unchangeable fee structure:**

1.  **Fixed Pool Fee**: The pool's operational fee is fixed at **1%**. This rate is hard-coded into the software and **cannot be modified by the operator**.
2.  **Operator's Revenue**: This 1% fee is the sole source of revenue for the pool operator (you). It is automatically deducted from mined block rewards and retained in your configured pool wallet to cover server costs, maintenance, and other expenses.
3.  **Guaranteed Miner Share**: Participating miners will fairly share the remaining **99%** of the block rewards according to the PPLNS algorithm.
4.  **Zero Developer Fee**: **Crucially, the original author of the nbpool software does not take any form of developer fee or share.** All revenue generated by the pool (the 1% fee) belongs entirely to the person who deploys and operates it.

**This model provides a clear incentive for operators to maintain a healthy pool while assuring miners that they are receiving the maximum possible reward with no hidden fees.**

## 📋 Prerequisites

Before you begin, please ensure you meet all of the following requirements:

1.  **Server**: A server with a public IP address, running **Ubuntu 24.04.2 LTS or a later version**.
2.  **nextBTC Full Node**: A fully installed and completely synchronized nextBTC Core wallet (full node) running on the server.
3.  **Sufficient Wallet Balance**: To ensure the payment script can process payouts to miners promptly and reliably, make sure the pool's full node wallet has an available balance of **at least 300 nextBTC**.

---

## 🔧 Deployment Steps

### Step 1: Installation & Preparation

First, upload the `nbpool.zip` package to your server's home directory (`~/`) and unzip it.

```bash
# Unzip the package
unzip nbpool.zip

# Navigate into the nbpool directory
cd ~/nbpool

# Grant executable permissions to all binaries
chmod +x *
```

After unzipping, you will find three core executable files:
*   `nextbtcpool`: The main pool server program.
*   `payment_script`: The automated payout and reward distribution script.
*   `api_server`: The API server for querying statistics.

### Step 2: Configure the nextBTC Full Node

Ensure your full node's `bitcoin.conf` configuration file includes the following settings. This allows the pool software to communicate securely with your node via RPC.

**Important**: If any of these settings are missing from your `bitcoin.conf`, add them and then **completely restart** the nextBTC Core wallet.

```properties
# Enable the RPC server
server=1 
# Listen on all network interfaces for connections
listen=1
# Maintain a full transaction index, required by the payment script
txindex=1
# --- RPC Authentication ---
rpcuser=nextbtc
rpcpassword=nextbtc
# Bind to the local loopback address for security
rpcbind=127.0.0.1
# Only allow RPC connections from localhost
rpcallowip=127.0.0.1
# The RPC port
rpcport=8554
# Set a fallback fee in case fee estimation fails
fallbackfee=0.0001
# Automatically load the specified pool wallet on startup
wallet=pool_hot_wallet
```
> **Tip**: You can customize the `rpcuser` and `rpcpassword`, but you must ensure they match the configuration in `nbpool.conf` in a later step.

### Step 3: Create and Configure the Pool Wallet

For security and management purposes, we will create a dedicated hot wallet for the pool.

```bash
# Create a new wallet named "pool_hot_wallet"
bitcoin-cli createwallet "pool_hot_wallet"

# Generate a new receiving address for this wallet. This address will receive all block rewards mined by the pool.
# Be sure to save the generated address; you will need it for the next step.
bitcoin-cli -rpcwallet=pool_hot_wallet getnewaddress "nbPool address"
```

### Step 4: Configure the Pool Software

Next, edit the main pool configuration file, `nbpool.conf`.

```bash
vim nbpool.conf
```

Modify the contents to match the format below, ensuring you update the critical fields with your specific information:

```json
{
    "btcd" :  [
        {
            "url" : "127.0.0.1:8554",
            "auth" : "nextbtc",
            "pass" : "nextbtc",
            "notify" : false
        }
    ],

    "btcaddress" : "bc1..................................................",
    "btcsig" : "/Mined by YourPoolName/",

    "serverurl" : [
        "0.0.0.0:13003"
    ],

    "mindiff" : 1,
    "startdiff" : 1,
    "maxdiff" : 0
}
```

**Key fields to modify:**
*   `auth` / `pass`: Must match the `rpcuser` / `rpcpassword` you set in `bitcoin.conf` **exactly**.
*   `btcaddress`: Must be replaced with the pool's receiving address you generated in **Step 3**.
*   `btcsig`: (Optional) You can customize this signature, which will appear in the coinbase transaction of blocks mined by your pool.
*   `serverurl`: `0.0.0.0:13003` instructs the pool to listen on port `13003` on all available network interfaces. You can change the port if needed.

Save and exit the editor once you have made the changes.

### Step 5: Launch the Pool Service

You are all set! You can now start the main pool program. It is highly recommended to run it in the background using `nohup` or within a `screen`/`tmux` session to prevent it from terminating if your SSH connection drops.

```bash
# Start the pool in the background and redirect its log output to pool.log
nohup ./nextbtcpool -c nbpool.conf -l 7 > pool.log 2>&1 &
```
Your pool is now running and listening for miner connections on port `13003`.

---

## ⛏️ Miner Connection Guide

Miners can connect to your pool using any mining software that supports the SHA256d algorithm.

*   **Pool URL**: `stratum+tcp://%POOL_SERVER_IP%:13003`
*   **Username**: `%WALLET_ADDRESS%` (The miner's own nextBTC receiving address)
*   **Password**: Any string (e.g., `x` or `nextbtc`)

**cpuminer-opt Example:**
```bash
cpuminer-avx2.exe -a sha256d -o stratum+tcp://%POOL_SERVER_IP%:13003 -u %WALLET_ADDRESS% -p x -t 3
```
> Replace `%POOL_SERVER_IP%` with your server's public IP address and `%WALLET_ADDRESS%` with the miner's personal wallet address.

---

## 💰 Management & Automated Payouts

### Configure the Automated Payment Script

To automatically distribute the rewards collected by the pool to the miners who have earned them, we need to set up a scheduled task (cron job) to run the `payment_script`.

1.  Open the crontab editor:
    ```bash
    crontab -e
    ```

2.  Add the following line to the end of the file:
    ```crontab
    0 */4 * * * /root/nbpool/payment_script >> /root/nbpool/logs/payment.log 2>&1
    ```
    > **Explanation**: This configuration will automatically execute the payment script **every 4 hours**. All output, including successful payment records and any errors, will be appended to the log file at `/root/nbpool/logs/payment.log`. The script will process payouts for all miners whose balance has reached the **0.1 nextBTC** minimum threshold.

3.  Save and exit the crontab editor.

### Launch the API Query Server

To allow miners to view pool statistics and their personal mining data, start the `api_server`.

```bash
cd ~/nbpool
# Start the API server in the background and log its output to api.log
nohup ./api_server > api.log 2>&1 &
```

Once started, anyone can access the pool's statistics by visiting `http://%POOL_SERVER_IP%:13002` in a web browser.
> **Note**: The API server port is currently fixed to `13002` and cannot be customized.

**Congratulations! You have successfully deployed a fully functional and transparent nextBTC mining pool.**
======================================================================================
# nbpool - nextBTC自托管矿池部署指南

## 🚀 简介

**nbpool** 是一个专为 nextBTC 网络设计的轻量级、高性能的自托管矿池。它采用 **PPLNS (Pay Per Last N Shares)** 收益分配模式，旨在为社区成员提供一个稳定、透明且易于部署的挖矿解决方案。

## ✨ 核心特性

*   **PPLNS 分配模式**: 公平奖励长期忠诚的矿工。
*   **免注册**: 挖矿用户无需注册，直接使用其 nextBTC 钱包地址作为用户名即可开始挖矿。
*   **自动支付**: 系统自动为达到最低支付门槛的用户批量处理付款，无需人工干预。
*   **轻量高效**: 资源占用低，对服务器要求友好。
*   **API支持**: 提供简洁的API服务，方便用户查询矿池状态和个人算力。
*   **<ins>透明的费用模型</ins>**: **<ins>固定的1%矿池费用，无任何开发者抽水，保证运营者和矿工的收益透明化。</ins>**

## 💰 **费用结构与收益透明度**

**为了建立完全的信任和透明度，nbpool 采用了清晰且不可更改的费用结构：**

1.  **固定的矿池费用**: 矿池的运营费用固定为 **1%**。这个费率是硬编码在程序中的，**部署者无法修改**。
2.  **运营者收益**: 这 1% 的费用是矿池部署者（即您）的唯一收益来源。它会自动从挖出的区块奖励中扣除，并保留在您配置的矿池收款地址中，用于覆盖服务器、维护等成本。
3.  **矿工收益保障**: 参与挖矿的用户将根据PPLNS算法，公平分配剩余 **99%** 的区块奖励。
4.  **零开发者抽水**: **至关重要的一点是，nbpool 矿池软件的原始作者不收取任何形式的开发者费用或抽水。** 所有矿池产生的收益（即那1%的费用）完全归属于矿池的部署和运营者。

**这个模型确保了矿池部署者有明确的激励来维护矿池，同时也向矿工保证了他们能获得最大化的、无隐藏费用的挖矿回报。**

## 📋 部署前置条件

在开始之前，请确保您已满足以下所有条件：

1.  **服务器**: 一台拥有公网IP的服务器，操作系统为 **Ubuntu 24.04.2 LTS 或更高版本**。
2.  **nextBTC 全节点**: 服务器上已成功部署并完全同步了 nextBTC 核心钱包（全节点）。
3.  **充足的钱包余额**: 为确保支付脚本能顺利、及时地为矿工发放奖励，请确保矿池连接的全节点钱包中**至少有 300 nextBTC** 的可用余额。

---

## 🔧 部署步骤

### 步骤 1: 安装与准备

首先，将 `nbpool.zip` 软件包上传到您的服务器主目录 (`~/`) 并解压。

```bash
# 解压软件包
unzip nbpool.zip

# 进入nbpool目录
cd ~/nbpool

# 为所有程序授予可执行权限
chmod +x *
```

解压后，您会看到三个核心程序文件：
*   `nextbtcpool`: 矿池主服务程序。
*   `payment_script`: 自动支付与奖励分配脚本。
*   `api_server`: 用于数据查询的API服务。

### 步骤 2: 配置 nextBTC 全节点

确保您的全节点 `bitcoin.conf` 配置文件中包含以下设置。这将允许矿池程序通过RPC安全地与您的节点通信。

**重要**: 如果您的 `bitcoin.conf` 中缺少任何一项，请添加后**完全重启** nextBTC 核心钱包。

```properties
# 启用RPC服务
server=1 
# 监听所有网络接口，以便矿池连接
listen=1
# 维护完整的交易索引，支付脚本需要此功能
txindex=1
# --- RPC认证信息 ---
rpcuser=nextbtc
rpcpassword=nextbtc
# 仅绑定到本地回环地址以策安全
rpcbind=127.0.0.1
# 仅允许来自本地的RPC连接
rpcallowip=127.0.0.1
# RPC端口
rpcport=8554
# 设定一个默认的交易费，以防费用估算失败
fallbackfee=0.0001
# 启动时自动加载指定的矿池钱包
wallet=pool_hot_wallet
```
> **提示**: 您可以自定义 `rpcuser` 和 `rpcpassword`，但必须确保它们与后续 `nbpool.conf` 中的配置保持一致。

### 步骤 3: 创建并配置矿池专用钱包

为了安全和管理方便，我们将为矿池创建一个专用的热钱包。

```bash
# 创建一个名为 "pool_hot_wallet" 的新钱包
bitcoin-cli createwallet "pool_hot_wallet"

# 为新钱包生成一个收款地址，用于接收所有挖矿产出的区块奖励
# 请务必妥善保管这个生成的地址，下一步配置中会用到
bitcoin-cli -rpcwallet=pool_hot_wallet getnewaddress "nbPool address"
```

### 步骤 4: 配置矿池

现在，编辑矿池的主配置文件 `nbpool.conf`。

```bash
vim nbpool.conf
```

将其中的内容修改为如下格式，并确保关键字段已更新为您的实际信息：

```json
{
    "btcd" :  [
        {
            "url" : "127.0.0.1:8554",
            "auth" : "nextbtc",
            "pass" : "nextbtc",
            "notify" : false
        }
    ],

    "btcaddress" : "bc1..................................................",
    "btcsig" : "/Mined by YourPoolName/",

    "serverurl" : [
        "0.0.0.0:13003"
    ],

    "mindiff" : 1,
    "startdiff" : 1,
    "maxdiff" : 0
}
```

**关键修改项:**
*   `auth` / `pass`: 必须与您在 `bitcoin.conf` 中设置的 `rpcuser` / `rpcpassword` **完全一致**。
*   `btcaddress`: 必须替换为您在**步骤 3** 中生成的矿池收款地址。
*   `btcsig`: (可选) 您可以修改这里的签名信息，它会出现在矿池挖出的区块中。
*   `serverurl`: `0.0.0.0:13003` 表示矿池将监听服务器上所有网络接口的 `13003` 端口。您可以根据需要修改端口号。

修改完成后，保存并退出编辑器。

### 步骤 5: 启动矿池服务

一切就绪！现在可以启动矿池主程序了。我们建议使用 `nohup` 或 `screen`/`tmux` 以后台模式运行，以防SSH断开连接。

```bash
# 以后台模式启动矿池，并将日志输出到 pool.log
nohup ./nextbtcpool -c nbpool.conf -l 7 > pool.log 2>&1 &
```
现在，您的矿池已经在 `13003` 端口上运行并等待矿工连接。

---

## ⛏️ 矿工连接指南

矿工可以使用任何支持 SHA256d 算法的挖矿软件连接到您的矿池。

*   **矿池地址 (URL)**: `stratum+tcp://%POOL_SERVER_IP%:13003`
*   **用户名 (Username)**: `%WALLET_ADDRESS%` (矿工自己的nextBTC收款地址)
*   **密码 (Password)**: 任意字符 (例如 `x` 或 `nextbtc`)

**cpuminer-opt 示例:**
```bash
cpuminer-avx2.exe -a sha256d -o stratum+tcp://%POOL_SERVER_IP%:13003 -u %WALLET_ADDRESS% -p x -t 3
```
> 请将 `%POOL_SERVER_IP%` 替换为您服务器的公网IP地址，将 `%WALLET_ADDRESS%` 替换为矿工自己的钱包地址。

---

## 💰 管理与自动支付

### 配置自动支付脚本

为了将矿池地址收到的奖励自动分配给达标的矿工，我们需要设置一个定时任务来执行 `payment_script`。

1.  打开 `crontab` 编辑器：
    ```bash
    crontab -e
    ```

2.  在文件末尾添加以下一行：
    ```crontab
    0 */4 * * * /root/nbpool/payment_script >> /root/nbpool/logs/payment.log 2>&1
    ```
    > **说明**: 此配置会**每隔4小时**自动执行一次支付脚本。所有执行日志（包括成功和失败的记录）都将附加到 `/root/nbpool/logs/payment.log` 文件中。脚本会自动为所有余额达到 **0.1 nextBTC** 最低支付门槛的用户发起转账。

3.  保存并退出 `crontab`。

### 启动API查询服务

为了让矿工可以查询矿池状态和个人挖矿数据，请启动 `api_server`。

```bash
cd ~/nbpool
# 以后台模式启动API服务
nohup ./api_server > api.log 2>&1 &
```

启动后，任何人都可以通过访问 `http://%POOL_SERVER_IP%:13002` 来查看矿池统计信息。
> **注意**: API服务的端口当前固定为 `13002`，暂不支持自定义。

**恭喜！您已成功部署并运行了一个功能完善、收益透明的 nextBTC 矿池。**

================================================================
